FROM mambaorg/micromamba:latest

USER root

# 1. Install xengsort and multiqc into base
RUN micromamba install -y -n base \
    -c bioconda -c conda-forge -c defaults \
    "python>=3.12,<3.13" xengsort=2.1.0 multiqc=1.21 procps-ng \
    && micromamba clean --all --yes

# 2. Initialize micromamba (Corrected syntax)
RUN micromamba shell init --shell bash

# 3. Force non-interactive shells to source the bashrc
ENV BASH_ENV=/root/.bashrc
ENV PATH="/opt/conda/bin:$PATH"

# 4. Ensure activation for Docker and Singularity
ENV MAMBA_DOCKERFILE_ACTIVATE=1

WORKDIR /data
USER $MAMBA_USER

CMD ["/bin/bash"]
